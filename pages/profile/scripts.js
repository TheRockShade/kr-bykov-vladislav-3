"use strict";var n,o,s,a,c,u,i,t,r,d,l=document.querySelector(".profile-name_js"),p=document.querySelector(".profile-surname_js"),m=document.querySelector(".profile-email_js"),f=document.querySelector(".profile-location_js"),h=document.querySelector(".profile-age_js"),w=document.querySelector(".profile-photo_js"),g=localStorage.getItem("token"),e=localStorage.getItem("userId"),P=document.querySelector(".delete_js"),y={};function j(e){l.innerText=e.name,p.innerText=e.surname,m.innerText=e.email,f.innerText=e.location,h.innerText=e.age,w.innerText="",w.style="background-image: url(".concat(SERVER_URL).concat(e.photoUrl,")")}n=document.querySelector(".change-password_js"),o=document.querySelector(".popup--change-password"),s=document.forms["change-password"],a=!1,n&&n.addEventListener("click",function(){popup(o,n,s)}),s.addEventListener("submit",function(e){var t,r;(t=e).preventDefault(),a||(a=!0,r=getFormData(t.target,{},"FormData"),e=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};0===e.oldPassword.length&&(t.oldPassword="Пожалуйста, введите старый пароль");e.newPassword.length<4&&(t.newPassword="Ваш пороль слишком короткий");e.repeatPassword===e.newPassword&&""!==e.repeatPassword||(t.repeatPassword="Вы неправильно повторили пароль");e.oldPassword===e.newPassword&&(t.newPassword="Новый пароль должен отличаться от старого");return t}(getFormData(t.target),e={}),0<Object.keys(e).length?(setFormErrors(t.target,e),a=!1):fetchData({method:"PUT",body:r,url:"/api/users",headers:{"x-access-token":g}}).then(function(e){return e.json()}).then(function(e){if(!e.success)throw e;clearForm(t.target),setFormSuccess(t.target),setTimeout(function(){popupClose(o,n,s),answer(answerPopup,"Пароль был успешно изменён","success")},2e3),a=!1}).catch(function(e){e._message?answer(answerPopup,e._message,"error"):answer(answerPopup,"Ошибка сервера","error"),a=!1}))}),c=document.querySelector(".change-data_js"),u=document.querySelector(".popup--change-data"),i=document.forms["change-data"],t=document.querySelector(".file_js"),r=document.querySelector(".fileText_js"),d=!1,c&&c.addEventListener("click",function(){setValueToForm(i,y),popup(u,c,i)}),t.addEventListener("input",function(){var e;t.value&&(20<(e=t.value.slice(12)).length&&(e=e.slice(0,20)+"..."),r.innerHTML=e)}),i.addEventListener("submit",function(e){var t,r;(t=e).preventDefault(),d||(d=!0,r=getFormData(t.target,{},"FormData"),e=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};!isNaN(e.age)&&""!==e.age||(t.age="Введите возраст");return t}(getFormData(t.target)),0<Object.keys(e).length?(setFormErrors(t.target,e),d=!1):fetchData({method:"PUT",body:r,url:"/api/users",headers:{"x-access-token":g}}).then(function(e){return e.json()}).then(function(e){if(!e.success)throw e;j(e.data),setFormSuccess(t.target),setTimeout(function(){popupClose(u,c,i),answer(answerPopup,"Форма была успешно отправлена","success")},2e3),d=!1}).catch(function(e){e.errors?setFormErrors(i,e.errors):answer(answerPopup,"Ошибка сервера","error"),d=!1}))}),g&&e?fetchData({method:"GET",url:"/api/users/".concat(e),headers:{"Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(e){if(!e.success)throw e;j(y=e.data)}).catch(function(e){return window.location="/"}):window.location="/",P.addEventListener("click",function(){fetchData({method:"DELETE",url:"/api/users/".concat(e),headers:{"x-access-token":g}}).then(function(e){return e.json()}).then(function(e){if(!e.success)throw e;answer(answerPopup,"Пользователь был успешно удалён","success"),setTimeout(function(){logoutUser()},2e3)}).catch(function(){answer(answerPopup,"Ошибка сервера","error")})});